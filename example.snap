#!/usr/bin/env snaprotate

policy = recent <||> weekly <||> monthly

recent = (keepLastWithinDuration twodays) <?> "keep last 48h"
weekly = keepOnePerWeekLast4Weeks <?> "one per week, last month"
monthly =  keepOnePerMonth <?> "one per month, forever"

twodays = 2 * oneday
oneweek = 7 * oneday

keepOnePerMonth = keepOnePerTimeFormat "%Y-%m"

keepOnePerWeekLast4Weeks = keepOnePerWeek <&&> keepLast4Weeks

keepOnePerWeek = keepOnePerTimeFormat "%Y-%U"
keepLast4Weeks = keepLastWithinDuration (4 * oneweek)

